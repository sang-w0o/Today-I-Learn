# `즉시 로딩과 지연 로딩이란?`

## `Member를 조회할 때 Team도 함께 조회해야 할까?`

<img width="992" alt="스크린샷 2021-07-21 오후 4 18 53" src="https://user-images.githubusercontent.com/45676906/126447709-f3a07869-1e89-4a5e-a0f0-2b53f797f75d.png">

단순히 Member만 조회하는 로직이 많은데 매번 Member를 가져올 때마다 Team 까지 같이 가져오는 것은 좋지 않을 것인데요! 그래서 JPA에서는 `프록시`, `지연 로딩`의 기능을 제공합니다!

바로 코드를 보면서 알아보겠습니다. 

```java
@Entity
public class Member {

    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    @Column(name = "USERNAME")
    private String username;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "TEAM_ID")
    private Team team;
}
```

`@ManyToOne(fetch = FetchType.LAZY)` 이것처럼 `LAZY` 속성 값을 주면 `지연 로딩`이 적용이 되는데요! 이렇게 LAZY로 적용을 하면 Team 객체는 프록시를 조회하면 Member 클래스만 DB에서 조회한다는 뜻입니다.

Team의 속성을 사용하는 시점에 Team 정보를 DB에서 조회해서 가져오게 됩니다. 

<img width="1293" alt="스크린샷 2021-07-21 오후 4 24 51" src="https://user-images.githubusercontent.com/45676906/126448464-b0720ce8-a9ad-4084-850d-b434a4ae7a9b.png">

<br> <br>

## `지연 로딩 LAZY을 사용해서 프록시로 조회`

<img width="1510" alt="스크린샷 2021-07-21 오후 4 25 31" src="https://user-images.githubusercontent.com/45676906/126448549-15c21352-dfaf-410c-a428-cf9aa0dc82a5.png">

위와 같이 `Member`를 조회할 때는 `Team`은 프록시로 가져오게 되고 실제 Team이 사용될 때 Team을 DB에서 가져오는 것을 `Lazy loading` 이라고 합니다.

<br> <br>

## `Member, Team을 자주 같이 쓰는 일이 많다면?`

```java
@Entity
public class Member {

    @Id @GeneratedValue
    @Column(name = "MEMBER_ID")
    private Long id;

    @Column(name = "USERNAME")
    private String username;

    @ManyToOne(fetch = FetchType.EAGER)
    @JoinColumn(name = "TEAM_ID")
    private Team team;
}
```

`@ManyToOne(fetch = FetchType.EAGER)` 처럼 `EAGER`를 사용하여 한번에 Member, Team을 가져오는 것입니다. 이것을 `즉시 로딩`이라고 합니다. 

<img width="1297" alt="스크린샷 2021-07-21 오후 4 28 26" src="https://user-images.githubusercontent.com/45676906/126448940-b98e9f31-2d34-436f-bedc-1be6dbcfbcf6.png">

<br> <br>

## `프록시와 즉시 로딩 주의`

- 실무에서는 `즉시 로딩`을 사용하면 안됨!! (가급적 `지연 로딩`만 사용..)

- 즉시 로딩을 적용하면 예상하지 못한 SQL이 발생!

- `즉시 로딩은 JPQL에서 N + 1 문제를 일으킨다.`

- `@ManyToOne`, `@OneToOne`은 Default가 `즉시 로딩`이기 때문에 `지연 로딩`을 명시해서 사용해야 함