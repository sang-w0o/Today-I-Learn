# `AWS CodeDeploy 실습-1`

![스크린샷 2021-03-08 오후 3 17 42](https://user-images.githubusercontent.com/45676906/110282284-8fd04800-8021-11eb-88da-f47637b6248c.png)

EC2의 S3 접근 허용하게 하기 위해서 IAM 설정을 먼저 해보겠습니다. 

<img width="1792" alt="스크린샷 2021-03-08 오후 3 19 23" src="https://user-images.githubusercontent.com/45676906/110282354-b42c2480-8021-11eb-8e02-92e020f71113.png">

![스크린샷 2021-03-08 오후 3 22 13](https://user-images.githubusercontent.com/45676906/110282608-20a72380-8022-11eb-938c-e729de84cb34.png)

EC2를 클릭한 후에 `다음`을 누르겠습니다. 

<img width="1792" alt="스크린샷 2021-03-08 오후 3 23 30" src="https://user-images.githubusercontent.com/45676906/110282725-53511c00-8022-11eb-84cf-9876ad6d50d1.png">

![스크린샷 2021-03-08 오후 3 25 10](https://user-images.githubusercontent.com/45676906/110282857-8bf0f580-8022-11eb-8e40-10fdc731157d.png)

EC2 인스턴스에 CodeDeploy Agent를 설치하기 위해서 역할을 하나 더 만들겠습니다. 

![스크린샷 2021-03-08 오후 3 27 17](https://user-images.githubusercontent.com/45676906/110283085-dc685300-8022-11eb-86da-cb44ded2b846.png)

![스크린샷 2021-03-08 오후 3 27 27](https://user-images.githubusercontent.com/45676906/110283154-f3a74080-8022-11eb-8a20-2c1743873252.png)

<img width="1792" alt="스크린샷 2021-03-08 오후 3 30 07" src="https://user-images.githubusercontent.com/45676906/110283318-39640900-8023-11eb-851c-c87dc56b6b31.png">

위와 같이 역할 이름을 정한 후에 생성하겠습니다. 

이제 `EC2`를 하나 생성하겠습니다.

<br>

## `EC2 프리티어 만들기`

![스크린샷 2021-03-08 오후 3 34 21](https://user-images.githubusercontent.com/45676906/110283705-d9ba2d80-8023-11eb-80f9-ac7033bf17fa.png)

<img width="1792" alt="스크린샷 2021-03-08 오후 3 35 27" src="https://user-images.githubusercontent.com/45676906/110283799-ff473700-8023-11eb-86c2-3c1f73884624.png">

![스크린샷 2021-03-08 오후 3 36 35](https://user-images.githubusercontent.com/45676906/110283870-2140b980-8024-11eb-9c85-f2073eacd8c9.png)

![스크린샷 2021-03-08 오후 3 39 28](https://user-images.githubusercontent.com/45676906/110284058-85637d80-8024-11eb-9be5-cc6a832244c4.png)

이 태그를 설정하는 이유는 `CodeDeploy가 어떤 EC2에 배포를 할 지를 알아야 하기 때문에 태그로 구분을 해주는 것입니다.`

![스크린샷 2021-03-08 오후 3 42 40](https://user-images.githubusercontent.com/45676906/110284322-f9058a80-8024-11eb-9d29-6e8fcf2ba73f.png)

위와 같이 사용 하려는 `포트 번호`를 열어 준 후에 `다음`을 누르겠습니다. 

<img width="1792" alt="스크린샷 2021-03-08 오후 3 44 34" src="https://user-images.githubusercontent.com/45676906/110284482-3cf88f80-8025-11eb-923f-7a1a36f940b9.png">

`pem key`는 중요하기 때문에 잘 보관해놔야 합니다. 

<br>

## `Elastic IP`

- EC2 서버를 껐다 키게 되면 Public IP가 변경되기 때문에 `고정 IP`를 할당하겠습니다. 
- `탄력적 IP가 혼자 돌아가면 과금이 되기 때문에 서버 중지/정지/삭제 할 경우 EIP 먼저 relase 하고 인스턴스 중단해야 합니다.`

![스크린샷 2021-03-05 오후 2 52 51](https://user-images.githubusercontent.com/45676906/110073316-872e0680-7dc2-11eb-8894-7272d3db9d2d.png)

위의 `탄력적 IP`로 들어가겠습니다.

![스크린샷 2021-03-05 오후 2 53 46](https://user-images.githubusercontent.com/45676906/110073382-a462d500-7dc2-11eb-8acd-f6d1edf8752b.png)

그리고 `탄력적 IP 생성`을 누르겠습니다. 

![스크린샷 2021-03-05 오후 2 55 52](https://user-images.githubusercontent.com/45676906/110073575-f0157e80-7dc2-11eb-9cb8-8362d4ae241e.png)
 
`할당`을 누르겠습니다. 

![스크린샷 2021-03-05 오후 2 57 46](https://user-images.githubusercontent.com/45676906/110073725-35d24700-7dc3-11eb-9285-6360ed67c415.png)

![스크린샷 2021-03-05 오후 2 58 44](https://user-images.githubusercontent.com/45676906/110073788-5bf7e700-7dc3-11eb-9ba2-758e7ca7f03c.png)

![스크린샷 2021-03-05 오후 2 59 59](https://user-images.githubusercontent.com/45676906/110073866-82b61d80-7dc3-11eb-91d4-be90e27b0365.png)

이렇게 `탄력적 IP`가 할당되었습니다. 

![스크린샷 2021-03-05 오후 3 03 16](https://user-images.githubusercontent.com/45676906/110074115-03751980-7dc4-11eb-8df8-9a2fd2adc09d.png)

<br>

## `SSH로 EC2 접속하기`

```
1. AWS에서 발급 받은 pem 파일이 있는 위치로 이동합니다. 

2. chmod 400 파일명.pem

3. sudo ssh -i '파일명.pem' ubuntu@아이피주소
ex) sudo ssh -i 'AWS.pem' ubuntu@52.79.90.119
```

![title](https://user-images.githubusercontent.com/45676906/93416524-ecf40800-f8e0-11ea-8764-eba8cbaaafd2.png)

그러면 위와 같이 `EC2`에 접속할 수 있습니다.

<br>

## `EC2 접속 커스텀 하기`

매번 위와 같이 입력을 한 후에 접속하기는 매우 번거롭기 때문에 커스텀을 해보겠습니다. (해당 작업은 로컬 터미널에서 진행해야 합니다.)

```
cd ~/.ssh/
그리고 ls로 확인해보면 config 파일이 존재할 것입니다.

vi config 

Host [ssh 접속을 할때 IP 대신 사용할 호스트명]
  HostName [EC2의 EIP 주소]
  User ec2-user
  IdentityFile ~/.ssh/{pem 키 이름}   // 본인 pem 파일이 있는 경로를 설정해야 합니다.

예를들면 아래와 같이 수정하면 된다. 

Host sopt
  HostName 52.79.90.119
  User ubuntu
  IdentityFile ~/Desktop/AWS/SOPT_Server_AWS.pem       

그리고 여기서 Host를 sopt로 했기 때문에 이제 ssh sopt로 접속이 가능합니다.
```

<br>

## `EC2 Linux 서버 들어가서 설치할 것`

```
sudo yum update
sudo yum install ruby
sudo yum install wget (설치 되어있다면 패스)
wget https://aws-codedeploy-ap-northeast-2.s3.amazonaws.com/latest/install
chmod +x install
sudo ./install auto
sudo service codedeploy-agent status (설치 잘 되었는지 확인)
(The AWS CodeDeploy agent is running as PID 7510 -> 이것이 떠야 성공한 것임) 
```

<br>

## `CodeDeploy 실행 과정`
 
![스크린샷 2021-03-15 오후 1 09 49](https://user-images.githubusercontent.com/45676906/111102560-bba67d00-858f-11eb-9006-327163630a37.png)

