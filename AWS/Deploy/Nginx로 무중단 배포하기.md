# `들어가기 전에`

![test](https://user-images.githubusercontent.com/45676906/95607939-6a9dd480-0a97-11eb-8d68-55000fda8654.png)

이러한 구조로 자동화 배포를 진행한 적이 있습니다. Github에 push만 하면 자동으로 EC2에 새로운 버전의 jar가 배포되고 재 실행되어서 배포가 되었습니다. 하지만 위의 방식에는 단점이 존재합니다. 배포가 진행되는 도중에는 서버가 잠시 중단되야 한다는 점입니다.

CodeDeploy가 EC2에 새로운 버전의 jar를 배포할 때, 기존의 실행 중인 jar를 kill 한 후에 새로운 버전의 jar를 실행시킬 것입니다. 이 과정에서 서버가 잠시 중단되어 사용자들은 서비스에 접속할 수 없게 됩니다. 현재 우리가 많이 사용하고 있는 서비스들을 보면 새로운 버전의 업데이트가 일어나더라도 서비스가 중단되거나 하지 않고 `무중단`으로 배포가 이루어집니다.

무중단 배포에는 `인스턴스를 여러 개` 만들어 [현재 위치 배포 방식](https://devlog-wjdrbs96.tistory.com/304) 으로 할 수도 있고, [블루 그린 배포 방식](https://devlog-wjdrbs96.tistory.com/300) 으로 진행할 수도 있습니다.
하지만 프리티어를 유지하기 위해서는 1대의 EC2로만 운영해야 하기 때문에.. 2대 이상의 EC2를 만드는게 은근? 부담이 될 수 있습니다. 

그래서 이번 글에서는 `Nginx`를 이용해서 EC2 내부에 포트를 나눠서 `무중단 배포`를 진행해보겠습니다.   

![art](https://camo.githubusercontent.com/cc9fd5ff1b28c4d41067f7bdfd6563f7d01c610f14305a74b5c788d5f91821d1/68747470733a2f2f74312e6461756d63646e2e6e65742f6366696c652f746973746f72792f393936463736334435413733463931453236)

위와 같이 Nginx를 이용해서 실제 배포 중에도 서비스가 중단되지 않도록 하는 아키텍쳐를 만들어보겠습니다. 

<br> <br>

## `Nginx는 왜 사용하는가?`

- `Nginx는 고성능 웹서버입니다.`
- `Nginx의 리버스 프록시 기능이 존재합니다.`
    - `리버스 프록시란 외부의 요청을 받아 백엔드 서버로 요청을 전달하는 것을 의미합니다.`
- `다른 배포 방식에 비해서 저렴하고 쉽습니다.`

위에서 말했던 것처럼 이번 글의 예제에서는 EC2 인스턴스 하나로만 진행할 수 있기 때문에 비용이 들지 않는다는 장점이 있습니다. 

<br> <br>

# `Nginx로 무중단 배포하기`

현재 EC2는 Linux2 기반으로 할 것입니다. 먼저 Nginx를 설치하겠습니다.

```
sudo yum install nginx       // 설치
sudo service nginx start     // 시작
sudo service nginx stop      // 중지
sudo service nginx restart   // Nginx 서비스를 중지했다가 시작합니다.
sudo service nginx reload    // Nginx 서비스를 정상적으로 다시 시작합니다. 다시로드 할 때 기본 Nginx 프로세스는 자식 프로세스를 종료하고 새 구성을로드하며 새 자식 프로세스를 시작합니다.
sudo service nginx status    // 상태 확인
```

![스크린샷 2021-04-21 오후 4 27 13](https://user-images.githubusercontent.com/45676906/115513921-8db70580-a2be-11eb-8482-19e7f2505a8e.png)

설치를 한 후에 상태 확인을 하면 위와 같이 `active (running)`이 뜨는 것을 확인할 수 있습니다. 

<br>

